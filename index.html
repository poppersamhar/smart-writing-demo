<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能写作助手</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* 全局样式 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f8f9ff 0%, #f0f2ff 100%);
            min-height: 100vh;
            color: #333;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.1);
            border-radius: 12px;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        /* 顶部导航栏 */
        .top-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            background: white;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .app-name {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-btn {
            padding: 6px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
        }

        .header-btn:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .header-btn i {
            font-size: 14px;
            color: #495057;
        }

        /* API配置弹窗 */
        .config-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .config-modal.show {
            display: flex;
        }

        .config-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .config-content h3 {
            margin: 0 0 20px 0;
            color: #495057;
            font-size: 1.3rem;
        }

        .config-content input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .config-content input:focus {
            outline: none;
            border-color: #667eea;
        }

        .config-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .config-actions button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .config-actions .save-btn {
            background: #28a745;
            color: white;
        }

        .config-actions .save-btn:hover {
            background: #218838;
        }

        .config-actions .cancel-btn {
            background: #6c757d;
            color: white;
        }

        .config-actions .cancel-btn:hover {
            background: #5a6268;
        }

        /* 调试面板 */
        .debug-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            max-width: 300px;
            z-index: 999;
            display: none;
        }

        .debug-panel.show {
            display: block;
        }

        .debug-toggle {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            font-size: 12px;
            z-index: 999;
        }

        /* 主内容区 */
        .main-content {
            flex: 1;
            padding: 20px 30px;
            display: flex;
            flex-direction: column;
        }

        /* 欢迎区域 */
        .welcome-section {
            text-align: center;
            padding: 30px 20px;
            margin-bottom: 25px;
        }

        .welcome-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 12px;
        }

        .welcome-subtitle {
            font-size: 1rem;
            color: #666;
            margin-bottom: 25px;
        }

        .suggestion-questions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 600px;
            margin: 0 auto;
        }

        .suggestion-question {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 12px;
            padding: 15px 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.1);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .suggestion-question:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.95);
        }

        .suggestion-question i {
            font-size: 1.2rem;
            color: #667eea;
            flex-shrink: 0;
        }

        .suggestion-question span {
            font-size: 0.95rem;
            color: #333;
            line-height: 1.4;
        }

        /* 输出区域 */
        .output-section {
            flex: 1;
            margin-bottom: 25px;
        }

        .output-header {
            margin-bottom: 15px;
        }

        .output-text {
            width: 100%;
            min-height: 500px;
            padding: 25px;
            border: none;
            border-radius: 12px;
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 50%, #f5f9ff 100%);
            font-size: 14px;
            line-height: 1.6;
            overflow-y: auto;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.1);
            backdrop-filter: blur(10px);
        }

        /* 聊天对话样式 */
        .chat-history {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message {
            max-width: 85%;
            animation: fadeIn 0.3s ease;
        }

        .user-message {
            align-self: flex-end;
        }

        .ai-message {
            align-self: flex-start;
        }

        .message-content {
            padding: 15px 18px;
            border-radius: 18px;
            position: relative;
        }

        .user-message .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 6px;
        }

        .ai-message .message-content {
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-bottom-left-radius: 6px;
            backdrop-filter: blur(5px);
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 12px;
            opacity: 0.8;
        }

        .user-name, .ai-name {
            font-weight: 600;
        }

        .message-time {
            font-size: 11px;
        }

        .message-text {
            line-height: 1.5;
            word-wrap: break-word;
        }

        .message-operation {
            margin-top: 8px;
            font-size: 11px;
            opacity: 0.8;
            font-style: italic;
        }

        /* 复制回复按钮 */
        .copy-reply-btn {
            position: absolute;
            bottom: 8px;
            right: 8px;
            width: 24px;
            height: 24px;
            border: none;
            border-radius: 50%;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            opacity: 0;
        }

        .ai-message .message-content:hover .copy-reply-btn {
            opacity: 1;
        }

        .copy-reply-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: scale(1.1);
        }

        .copy-reply-btn i {
            font-size: 10px;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* 控制面板 */
        .control-panel {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 5px;
            flex-wrap: wrap;
            justify-content: flex-start;
            padding: 8px 0 2px 0;
            border-top: 1px solid #f0f0f0;
        }

        /* 模型选择器 */
        .model-selector {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .model-selector label {
            font-weight: 500;
            color: #495057;
            font-size: 12px;
        }

        .model-selector select {
            padding: 6px 10px;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            background: white;
            font-size: 12px;
            transition: border-color 0.3s ease;
        }

        .model-selector select:focus {
            outline: none;
            border-color: #667eea;
        }

        /* 操作按钮 */
        .operation-buttons {
            display: flex;
            gap: 6px;
        }

        .operation-btn {
            padding: 6px 12px;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            background: white;
            color: #495057;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .operation-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .operation-btn i {
            font-size: 12px;
        }

        .operation-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* 底部输入区域 */
        .bottom-input-section {
            background: white;
            padding: 2px 30px 15px 30px;
        }

        .input-container {
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 100%;
            margin: 0 auto;
        }

        .input-field {
            flex: 1;
            position: relative;
        }

        #input-text {
            width: 100%;
            height: 40px;
            padding: 10px 15px;
            border: 1px solid #e9ecef;
            border-radius: 20px;
            font-size: 14px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
            resize: none;
            outline: none;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        #input-text:focus {
            border-color: #667eea;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1), 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* 发送按钮 */
        .send-btn {
            position: absolute;
            bottom: 8px;
            right: 8px;
            width: 28px;
            height: 28px;
            border: none;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .send-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }

        .send-btn i {
            font-size: 12px;
        }



        /* 文件上传 */
        .file-upload {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .upload-btn {
            padding: 6px 12px;
            background: #28a745;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .upload-btn:hover {
            background: #218838;
            transform: translateY(-1px);
        }

        .upload-btn i {
            font-size: 12px;
        }

        .file-info {
            padding: 6px 12px;
            background: #e9ecef;
            border-radius: 6px;
            font-size: 12px;
            color: #6c757d;
        }

        /* 输入区域 */
        .input-section {
            flex: 1;
            margin-bottom: 20px;
        }

        .input-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .input-header h3 {
            color: #495057;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .action-btn {
            padding: 6px 12px;
            border: 1px solid #e9ecef;
            background: white;
            color: #6c757d;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
        }

        .action-btn:hover {
            background: #f8f9fa;
            border-color: #667eea;
            color: #667eea;
        }



        #input-text {
            width: 100%;
            height: 200px;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            resize: vertical;
            font-size: 14px;
            line-height: 1.6;
            transition: border-color 0.3s ease;
        }

        #input-text:focus {
            outline: none;
            border-color: #667eea;
        }

        /* 输出区域 */
        .output-section {
            flex: 1;
        }

        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .output-header h3 {
            color: #495057;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .output-text {
            width: 100%;
            min-height: 180px;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
            font-size: 14px;
            line-height: 1.6;
            overflow-y: auto;
        }

        .placeholder {
            text-align: center;
            color: #6c757d;
            padding: 40px 20px;
        }

        .placeholder i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #667eea;
        }

        .placeholder p {
            font-size: 16px;
        }

        /* 加载指示器 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-spinner {
            background: white;
            padding: 30px 40px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .loading-spinner i {
            font-size: 2rem;
            color: #667eea;
            margin-bottom: 15px;
        }

        .loading-spinner p {
            color: #495057;
            font-weight: 500;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .container {
                margin: 0;
                border-radius: 0;
                max-width: 100%;
                box-shadow: none;
            }
            
            .top-header {
                padding: 10px 15px;
            }
            
            .app-name {
                font-size: 1.3rem;
            }
            
            .main-content {
                padding: 15px 20px;
            }
            
            .welcome-section {
                padding: 20px 10px;
            }
            
            .welcome-title {
                font-size: 1.5rem;
            }
            
            .output-text {
                min-height: 450px;
                padding: 20px;
            }
            
            .message {
                max-width: 90%;
            }
            
            .message-content {
                padding: 12px 15px;
            }
            
            .copy-reply-btn {
                width: 20px;
                height: 20px;
                bottom: 6px;
                right: 6px;
            }
            
            .copy-reply-btn i {
                font-size: 9px;
            }
            
            .send-btn {
                width: 24px;
                height: 24px;
                bottom: 6px;
                right: 6px;
            }
            
            .send-btn i {
                font-size: 10px;
            }
            
            .suggestion-questions {
                max-width: 100%;
            }
            
            .suggestion-question {
                padding: 12px 15px;
            }
            
            .suggestion-question span {
                font-size: 0.9rem;
            }
            
            .control-panel {
                flex-direction: column;
                align-items: stretch;
                gap: 4px;
                margin-bottom: 8px;
                padding: 6px 0 2px 0;
            }
            
            .operation-buttons {
                justify-content: center;
            }
            
            .model-selector {
                justify-content: center;
            }
            
            .bottom-input-section {
                padding: 1px 20px 10px 20px;
            }
            
            .input-container {
                flex-direction: column;
                gap: 10px;
            }
            
            .file-upload {
                justify-content: center;
            }
            
            .file-upload {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .container {
                margin: 0;
                border-radius: 0;
            }
            
            .top-header {
                padding: 8px 10px;
            }
            
            .app-name {
                font-size: 1.2rem;
            }
            
            .header-actions {
                gap: 8px;
            }
            
            .header-btn {
                width: 26px;
                height: 26px;
                font-size: 10px;
            }
            
            .main-content {
                padding: 10px 15px;
            }
            
            .welcome-section {
                padding: 15px 8px;
            }
            
            .welcome-title {
                font-size: 1.3rem;
            }
            
            .suggestion-questions {
                max-width: 100%;
            }
            
            .suggestion-question {
                padding: 10px 12px;
            }
            
            .suggestion-question span {
                font-size: 0.85rem;
            }
            
            .output-text {
                min-height: 400px;
                padding: 15px;
            }
            
            .message {
                max-width: 95%;
            }
            
            .message-content {
                padding: 10px 12px;
            }
            
            .copy-reply-btn {
                width: 18px;
                height: 18px;
                bottom: 5px;
                right: 5px;
            }
            
            .copy-reply-btn i {
                font-size: 8px;
            }
            
            .send-btn {
                width: 22px;
                height: 22px;
                bottom: 5px;
                right: 5px;
            }
            
            .send-btn i {
                font-size: 9px;
            }
            
            .message-header {
                font-size: 11px;
            }
            
            .control-panel {
                gap: 6px;
                padding: 5px 0 1px 0;
            }
            
            .operation-btn {
                padding: 5px 10px;
                font-size: 11px;
            }
            
            .model-selector select {
                padding: 5px 8px;
                font-size: 11px;
            }
            
            .bottom-input-section {
                padding: 0px 15px 8px 15px;
            }
            
            #input-text {
                height: 35px;
                font-size: 12px;
            }
            

        }

        /* 滚动条样式 */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* 消息提示样式 */
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOut {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 顶部导航栏 -->
        <div class="top-header">
            <div class="logo-section">
                <div class="logo">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="app-name">超级助理</div>
            </div>
            <div class="header-actions">
                <button id="config-btn" class="header-btn" title="设置">
                    <i class="fas fa-cog"></i>
                </button>
                <button id="profile-btn" class="header-btn" title="个人主页">
                    <i class="fas fa-user"></i>
                </button>
            </div>
        </div>
        
        <!-- 主内容区 -->
        <div class="main-content">
            <!-- 输出区域 -->
            <div class="output-section">
                <div class="output-header">
                </div>
                <div id="output-text" class="output-text">
                    <!-- 欢迎区域 -->
                    <div class="welcome-section">
                        <div class="welcome-title">Hi, 晚上好! 辛苦了, 披星戴月的你</div>
                        <div class="welcome-subtitle">我是你的工作助理, 快来试着给我提问吧</div>
                        <div style="margin-bottom: 20px; color: #666;">快来试试这些用法</div>
                                        <div class="suggestion-questions">
                    <div class="suggestion-question" onclick="startConversation('summarize', '请帮我总结一下人工智能的发展历程和主要里程碑')">
                        <i class="fas fa-compress-alt"></i>
                        <span>请帮我总结一下人工智能的发展历程和主要里程碑</span>
                    </div>
                    <div class="suggestion-question" onclick="startConversation('expand', '请帮我扩写关于人工智能在医疗领域应用的内容')">
                        <i class="fas fa-expand-alt"></i>
                        <span>请帮我扩写关于人工智能在医疗领域应用的内容</span>
                    </div>
                    <div class="suggestion-question" onclick="startConversation('continue', '随着科技的不断发展，我们的生活变得越来越便利')">
                        <i class="fas fa-arrow-right"></i>
                        <span>随着科技的不断发展，我们的生活变得越来越便利</span>
                    </div>
                </div>
                    </div>
                    <div class="result-content">
                        <p></p>
                    </div>
                </div>
            </div>
            
            <!-- 控制面板 -->
            <div class="control-panel">
                <!-- 模型选择 -->
                <div class="model-selector">
                    <label for="model-select">模型：</label>
                    <select id="model-select">
                        <option value="gpt-3.5-turbo" selected>GPT-3.5 Turbo (免费)</option>
                        <option value="gpt-4o">GPT-4o (免费)</option>
                        <option value="gpt-4o-mini">GPT-4o Mini (免费)</option>
                        <option value="gpt-4-turbo">GPT-4 Turbo (免费)</option>
                    </select>
                </div>
                
                <!-- 文件上传 -->
                <div class="file-upload">
                    <label for="file-input" class="upload-btn">
                        <i class="fas fa-upload"></i>
                        上传PDF
                    </label>
                    <input type="file" id="file-input" accept=".pdf" style="display: none;">
                </div>
                
                <!-- 操作按钮 -->
                <div class="operation-buttons">
                    <button class="operation-btn" data-operation="summarize">
                        <i class="fas fa-compress-alt"></i>
                        总结
                    </button>
                    <button class="operation-btn" data-operation="expand">
                        <i class="fas fa-expand-alt"></i>
                        扩写
                    </button>
                    <button class="operation-btn" data-operation="continue">
                        <i class="fas fa-arrow-right"></i>
                        续写
                    </button>
                </div>
            </div>
        </div>
        
        <!-- 底部输入区域 -->
        <div class="bottom-input-section">
            <div class="input-container">
                <div class="input-field">
                    <textarea id="input-text" placeholder="请输入你的问题"></textarea>
                    <button class="send-btn" onclick="handleSend()" title="发送">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
            <div id="file-info" class="file-info" style="display: none;"></div>
        </div>
        
        <!-- 加载指示器 -->
        <div id="loading" class="loading-overlay" style="display: none;">
            <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i>
                <p>正在处理中...</p>
            </div>
        </div>

        <!-- API配置弹窗 -->
        <div id="config-modal" class="config-modal">
            <div class="config-content">
                <h3><i class="fas fa-key"></i> 配置API密钥</h3>
                
                <!-- API类型选择 -->
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500;">选择API类型：</label>
                    <select id="config-api-type" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="free" selected>免费API (推荐)</option>
                        <option value="openai">OpenAI</option>
                        <option value="huggingface">Hugging Face</option>
                        <option value="ollama">Ollama (本地)</option>
                    </select>
                </div>
                
                <!-- 免费API配置 -->
                <div id="free-config" class="api-config-section">
                    <p style="color: #28a745; margin-bottom: 15px; font-size: 14px;">
                        ✅ <strong>免费API服务</strong> - 无需配置，直接使用即可！
                    </p>
                    <p style="color: #6c757d; margin-bottom: 15px; font-size: 14px;">
                        我们提供完全免费的AI写作服务，支持总结、扩写、续写功能。无需注册，无需API密钥，立即开始使用！
                    </p>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
                        <h4 style="margin: 0 0 10px 0; color: #28a745;">✨ 免费功能</h4>
                        <ul style="margin: 0; padding-left: 20px; color: #495057;">
                            <li>📝 智能文本总结</li>
                            <li>🚀 内容扩写增强</li>
                            <li>✍️ 智能续写功能</li>
                            <li>🆓 完全免费使用</li>
                        </ul>
                    </div>
                </div>
                
                <!-- OpenAI配置 -->
                <div id="openai-config" class="api-config-section" style="display: none;">
                    <p style="color: #6c757d; margin-bottom: 15px; font-size: 14px;">
                        请输入您的OpenAI API密钥。新用户有免费额度。获取地址：<a href="https://platform.openai.com/api-keys" target="_blank" style="color: #667eea;">OpenAI平台</a>
                    </p>
                    <input type="password" id="openai-api-key" placeholder="sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                </div>
                
                <!-- Hugging Face配置 -->
                <div id="huggingface-config" class="api-config-section" style="display: none;">
                    <p style="color: #6c757d; margin-bottom: 15px; font-size: 14px;">
                        请输入您的Hugging Face API密钥。有免费额度。获取地址：<a href="https://huggingface.co/settings/tokens" target="_blank" style="color: #667eea;">Hugging Face</a>
                    </p>
                    <input type="password" id="huggingface-api-key" placeholder="hf_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                </div>
                
                <!-- Ollama配置 -->
                <div id="ollama-config" class="api-config-section" style="display: none;">
                    <p style="color: #6c757d; margin-bottom: 15px; font-size: 14px;">
                        Ollama是本地运行的AI服务，完全免费。请先安装Ollama：<a href="https://ollama.ai" target="_blank" style="color: #667eea;">Ollama官网</a>
                    </p>
                    <p style="color: #28a745; font-size: 14px;">
                        ✅ 无需API密钥，直接使用即可
                    </p>
                </div>
                
                <div class="config-actions">
                    <button class="cancel-btn" onclick="closeConfigModal()">取消</button>
                    <button class="save-btn" onclick="saveApiKey()">保存</button>
                </div>
            </div>
        </div>

        <!-- 调试面板 -->
        <button id="debug-toggle" class="debug-toggle">调试模式</button>
        <div id="debug-panel" class="debug-panel">
            <h4>调试信息</h4>
            <div id="debug-content"></div>
        </div>
    </div>
    
    <script>
        // 全局变量
        let currentOperation = '';
        let currentModel = 'gpt-3.5-turbo';
        let currentApiType = 'free';

        // DOM元素
        const inputText = document.getElementById('input-text');
        const outputText = document.getElementById('output-text');
        const modelSelect = document.getElementById('model-select');
        const fileInput = document.getElementById('file-input');
        const fileInfo = document.getElementById('file-info');
        const loading = document.getElementById('loading');


        const configBtn = document.getElementById('config-btn');
        const configModal = document.getElementById('config-modal');
        const configApiTypeSelect = document.getElementById('config-api-type');
        const freeConfig = document.getElementById('free-config');
        const openaiConfig = document.getElementById('openai-config');
        const huggingfaceConfig = document.getElementById('huggingface-config');
        const ollamaConfig = document.getElementById('ollama-config');
        const openaiApiKeyInput = document.getElementById('openai-api-key');
        const huggingfaceApiKeyInput = document.getElementById('huggingface-api-key');
        const debugToggle = document.getElementById('debug-toggle');
        const debugPanel = document.getElementById('debug-panel');
        const debugContent = document.getElementById('debug-content');
        const apiTypeSelect = document.getElementById('api-type');

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
        });

        // 初始化事件监听器
        function initializeEventListeners() {
            // 操作按钮点击事件
            document.querySelectorAll('.operation-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const operation = this.dataset.operation;
                    handleOperation(operation);
                });
            });

            // API类型选择变化事件
            apiTypeSelect.addEventListener('change', function() {
                currentApiType = this.value;
                updateModelOptions();
            });

            // 模型选择变化事件
            modelSelect.addEventListener('change', function() {
                currentModel = this.value;
            });

            // 文件上传事件
            fileInput.addEventListener('change', handleFileUpload);





            // 输入框变化事件
            inputText.addEventListener('change', function() {
                if (this.value.trim()) {
                    enableOperationButtons();
                } else {
                    disableOperationButtons();
                }
            });

            // 配置按钮事件
            configBtn.addEventListener('click', openConfigModal);
            
            // 个人主页按钮事件
            document.getElementById('profile-btn').addEventListener('click', function() {
                showMessage('个人主页功能开发中...', 'info');
            });

            // 配置弹窗事件
            configApiTypeSelect.addEventListener('change', updateConfigSection);

            // 调试面板事件
            debugToggle.addEventListener('click', toggleDebugPanel);

            // 检查是否已配置API密钥
            checkApiKeyStatus();
        }

        // 处理操作按钮点击
        function handleOperation(operation) {
            const text = inputText.value.trim();
            
            if (!text) {
                showMessage('请输入文本内容', 'error');
                return;
            }

            currentOperation = operation;
            updateActiveButton(operation);
            
            // 调用真实AI处理
            processWithAI(text, operation);
        }

                // 更新模型选项
        function updateModelOptions() {
            const models = {
                free: [
                    { value: 'gpt-3.5-turbo', text: 'GPT-3.5 Turbo (免费)' },
                    { value: 'gpt-4o', text: 'GPT-4o (免费)' },
                    { value: 'gpt-4o-mini', text: 'GPT-4o Mini (免费)' },
                    { value: 'gpt-4-turbo', text: 'GPT-4 Turbo (免费)' }
                ],
                openai: [
                    { value: 'gpt-4o', text: 'GPT-4o' },
                    { value: 'gpt-4o-mini', text: 'GPT-4o Mini' },
                    { value: 'gpt-4-turbo', text: 'GPT-4 Turbo' },
                    { value: 'gpt-3.5-turbo', text: 'GPT-3.5 Turbo' }
                ],
                huggingface: [
                    { value: 'microsoft/DialoGPT-medium', text: 'DialoGPT (中文)' },
                    { value: 'THUDM/chatglm2-6b', text: 'ChatGLM2-6B' },
                    { value: 'fnlp/moss-moon-003-sft', text: 'MOSS-Moon' },
                    { value: 'baichuan-inc/Baichuan2-7B-Chat', text: 'Baichuan2-7B' }
                ],
                ollama: [
                    { value: 'llama2', text: 'Llama2' },
                    { value: 'llama2:13b', text: 'Llama2-13B' },
                    { value: 'llama2:7b', text: 'Llama2-7B' },
                    { value: 'codellama', text: 'Code Llama' },
                    { value: 'mistral', text: 'Mistral' },
                    { value: 'qwen', text: 'Qwen' }
                ]
            };

            const currentModels = models[currentApiType];
            modelSelect.innerHTML = '';
            
            currentModels.forEach(model => {
                const option = document.createElement('option');
                option.value = model.value;
                option.textContent = model.text;
                if (model.value === currentModel) {
                    option.selected = true;
                }
                modelSelect.appendChild(option);
            });

            currentModel = currentModels[0].value;
        }

        // 真实AI处理
        async function processWithAI(text, operation) {
            showLoading(true);
            
            try {
                // 根据操作类型构建提示词
                let prompt = '';
                switch(operation) {
                    case 'summarize':
                        prompt = `请对以下文本进行简洁的总结：\n\n${text}`;
                        break;
                    case 'expand':
                        prompt = `请对以下文本进行扩写，增加更多细节和内容：\n\n${text}`;
                        break;
                    case 'continue':
                        prompt = `请续写以下文本，保持风格一致：\n\n${text}`;
                        break;
                }

                const debugInfo = {
                    apiType: currentApiType,
                    model: currentModel,
                    operation: operation,
                    textLength: text.length
                };
                console.log('正在调用API:', debugInfo);
                addDebugInfo(`调用API: ${currentApiType} - ${currentModel} - ${operation}`);

                let result;
                
                switch(currentApiType) {
                    case 'free':
                        result = await callFreeAPI(prompt);
                        break;
                    case 'openai':
                        result = await callOpenAI(prompt);
                        break;
                    case 'huggingface':
                        result = await callHuggingFace(prompt);
                        break;
                    case 'ollama':
                        result = await callOllama(prompt);
                        break;
                    default:
                        throw new Error('不支持的API类型');
                }
                
                displayResult(result, operation);
                showMessage('处理完成', 'success');
                
            } catch (error) {
                console.error('AI处理错误:', error);
                // 使用兜底回复
                const fallbackResponse = getFallbackResponse(operation, text);
                displayResult(fallbackResponse, operation);
                showMessage('使用兜底回复', 'info');
            } finally {
                showLoading(false);
            }
        }

        // OpenAI API调用
        async function callOpenAI(prompt) {
            const apiKey = localStorage.getItem('openai_api_key');
            if (!apiKey) {
                throw new Error('请先配置OpenAI API密钥');
            }

            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: currentModel,
                    messages: [
                        {
                            role: 'system',
                            content: '你是一个专业的写作助手，能够帮助用户进行文本总结、扩写和续写。请用中文回答。'
                        },
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    max_tokens: 2000,
                    temperature: 0.7
                })
            });

            addDebugInfo(`OpenAI响应状态: ${response.status}`);

            if (!response.ok) {
                const errorText = await response.text();
                addDebugInfo(`OpenAI错误: ${errorText}`);
                throw new Error(`OpenAI API错误: ${response.status}`);
            }

            const data = await response.json();
            if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                throw new Error('OpenAI返回数据格式错误');
            }

            return data.choices[0].message.content;
        }

        // Hugging Face API调用
        async function callHuggingFace(prompt) {
            const apiKey = localStorage.getItem('huggingface_api_key');
            if (!apiKey) {
                throw new Error('请先配置Hugging Face API密钥');
            }

            const response = await fetch(`https://api-inference.huggingface.co/models/${currentModel}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    inputs: prompt,
                    parameters: {
                        max_new_tokens: 500,
                        temperature: 0.7
                    }
                })
            });

            addDebugInfo(`Hugging Face响应状态: ${response.status}`);

            if (!response.ok) {
                const errorText = await response.text();
                addDebugInfo(`Hugging Face错误: ${errorText}`);
                throw new Error(`Hugging Face API错误: ${response.status}`);
            }

            const data = await response.json();
            return data[0]?.generated_text || '处理失败';
        }

        // 免费API调用
        async function callFreeAPI(prompt) {
            // 使用免费的文本生成API
            const response = await fetch('https://api.freeai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer free-token'
                },
                body: JSON.stringify({
                    model: currentModel,
                    messages: [
                        {
                            role: 'system',
                            content: '你是一个专业的写作助手，能够帮助用户进行文本总结、扩写和续写。请用中文回答。'
                        },
                        {
                            role: 'user',
                            content: prompt
                        }
                    ],
                    max_tokens: 1000,
                    temperature: 0.7
                })
            });

            addDebugInfo(`免费API响应状态: ${response.status}`);

            if (!response.ok) {
                // 如果免费API不可用，使用模拟响应
                addDebugInfo('免费API不可用，使用模拟响应');
                return generateMockResponse(prompt);
            }

            const data = await response.json();
            if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                return generateMockResponse(prompt);
            }

            return data.choices[0].message.content;
        }

        // 生成模拟响应
        function generateMockResponse(prompt) {
            const operation = currentOperation;
            const text = prompt.replace(/请对以下文本进行(.+?)：\n\n/, '').replace(/\n\n.*$/, '');
            
            let result = '';
            switch(operation) {
                case 'summarize':
                    result = `📝 总结结果：\n\n${text.substring(0, Math.min(200, text.length))}...\n\n💡 核心要点：\n• 这是一个关于${text.includes('技术') ? '技术' : text.includes('学习') ? '学习' : '内容'}的文本\n• 主要讨论了相关的重要概念\n• 提供了实用的建议和指导\n\n✨ 总结：以上内容的核心要点是${text.includes('技术') ? '技术发展的重要性' : text.includes('学习') ? '学习方法的重要性' : '内容的价值'}。`;
                    break;
                case 'expand':
                    result = `🚀 扩写内容：\n\n${text}\n\n📖 扩展部分：\n\n基于原文内容，我们可以进一步扩展和深化以下几个方面：\n\n1. **背景分析**\n   ${text}的背景可以追溯到更早的时期，这为我们理解当前情况提供了重要视角。\n\n2. **详细说明**\n   让我们更深入地探讨${text.includes('技术') ? '技术' : text.includes('学习') ? '学习' : '这个主题'}的各个方面，包括其发展历程、现状和未来趋势。\n\n3. **实际应用**\n   在实际应用中，${text.includes('技术') ? '技术' : text.includes('学习') ? '学习' : '这些内容'}可以带来显著的价值和效益。\n\n4. **总结展望**\n   通过以上扩展，我们可以看到${text.includes('技术') ? '技术' : text.includes('学习') ? '学习' : '这个主题'}的重要性和发展潜力。`;
                    break;
                case 'continue':
                    result = `✍️ 续写内容：\n\n${text}\n\n🔄 续写部分：\n\n继续原文的思路，我们可以这样展开：\n\n${text}的发展趋势表明，未来将会出现更多创新和突破。在这个过程中，我们需要保持开放的心态，积极拥抱变化。\n\n同时，我们也应该注意到，${text.includes('技术') ? '技术' : text.includes('学习') ? '学习' : '这个领域'}的发展离不开持续的努力和探索。只有不断学习和实践，才能在这个快速变化的时代中保持竞争力。\n\n展望未来，${text.includes('技术') ? '技术' : text.includes('学习') ? '学习' : '这个主题'}将继续发挥重要作用，为我们的工作和生活带来更多便利和可能性。`;
                    break;
                default:
                    result = `🤖 AI助手响应：\n\n${text}\n\n我已经理解了您的内容，这是一个很有价值的${text.includes('技术') ? '技术' : text.includes('学习') ? '学习' : '主题'}。如果您需要进一步的帮助，请告诉我具体的要求。`;
            }
            
            return result;
        }

        // Ollama API调用 (本地)
        async function callOllama(prompt) {
            const response = await fetch('http://localhost:11434/api/generate', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: currentModel,
                    prompt: prompt,
                    stream: false,
                    options: {
                        temperature: 0.7,
                        num_predict: 500
                    }
                })
            });

            addDebugInfo(`Ollama响应状态: ${response.status}`);

            if (!response.ok) {
                const errorText = await response.text();
                addDebugInfo(`Ollama错误: ${errorText}`);
                throw new Error(`Ollama API错误: ${response.status} - 请确保Ollama服务正在运行`);
            }

            const data = await response.json();
            return data.response || '处理失败';
        }

        // 更新活动按钮状态
        function updateActiveButton(operation) {
            document.querySelectorAll('.operation-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.operation === operation) {
                    btn.classList.add('active');
                }
            });
        }

        // 显示处理结果
        function displayResult(result, operation) {
            const timestamp = new Date().toLocaleTimeString();
            const operationText = {
                'summarize': '总结',
                'expand': '扩写',
                'continue': '续写'
            };
            
            // 获取当前聊天记录
            let chatHistory = outputText.querySelector('.chat-history');
            if (!chatHistory) {
                chatHistory = document.createElement('div');
                chatHistory.className = 'chat-history';
                outputText.innerHTML = '';
                outputText.appendChild(chatHistory);
            }
            
            // 添加用户消息
            const userMessage = document.createElement('div');
            userMessage.className = 'message user-message';
            userMessage.innerHTML = `
                <div class="message-content">
                    <div class="message-header">
                        <span class="user-name">用户</span>
                        <span class="message-time">${timestamp}</span>
                    </div>
                    <div class="message-text">${inputText.value.replace(/\n/g, '<br>')}</div>
                    <div class="message-operation">操作：${operationText[operation]}</div>
                </div>
            `;
            chatHistory.appendChild(userMessage);
            
            // 添加AI回复
            const aiMessage = document.createElement('div');
            aiMessage.className = 'message ai-message';
            aiMessage.innerHTML = `
                <div class="message-content">
                    <div class="message-header">
                        <span class="ai-name">超级助理</span>
                        <span class="message-time">${timestamp}</span>
                    </div>
                    <div class="message-text">${result.replace(/\n/g, '<br>')}</div>
                    <button class="copy-reply-btn" onclick="copyReply(this)" title="复制回复">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
            `;
            chatHistory.appendChild(aiMessage);
            
            // 滚动到底部
            outputText.scrollTop = outputText.scrollHeight;
        }

        // 处理文件上传
        function handleFileUpload(event) {
            const file = event.target.files[0];
            
            if (!file) {
                return;
            }

            if (!file.name.toLowerCase().endsWith('.pdf')) {
                showMessage('只支持PDF文件', 'error');
                return;
            }

            showLoading(true);
            
            // 模拟文件处理
            setTimeout(() => {
                // 这里应该调用实际的PDF处理API
                const mockText = `这是从PDF文件 "${file.name}" 中提取的文本内容。\n\n在实际应用中，这里会显示PDF的真实内容。\n\n您可以在这里输入或修改文本内容。`;
                
                inputText.value = mockText;
                fileInfo.innerHTML = `
                    <i class="fas fa-file-pdf"></i>
                    已上传: ${file.name}
                `;
                enableOperationButtons();
                showMessage('PDF文件上传成功', 'success');
                showLoading(false);
            }, 1500);
        }







        // 显示/隐藏加载指示器
        function showLoading(show) {
            loading.style.display = show ? 'flex' : 'none';
        }

        // 启用操作按钮
        function enableOperationButtons() {
            document.querySelectorAll('.operation-btn').forEach(btn => {
                btn.disabled = false;
                btn.style.opacity = '1';
            });
        }

        // 禁用操作按钮
        function disableOperationButtons() {
            document.querySelectorAll('.operation-btn').forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = '0.5';
            });
        }

        // 重置输出区域
        function resetOutput() {
            outputText.innerHTML = `
                <!-- 欢迎区域 -->
                <div class="welcome-section">
                    <div class="welcome-title">Hi, 晚上好! 辛苦了, 披星戴月的你</div>
                    <div class="welcome-subtitle">我是你的工作助理, 快来试着给我提问吧</div>
                    <div style="margin-bottom: 20px; color: #666;">快来试试这些用法</div>
                    <div class="suggestion-questions">
                        <div class="suggestion-question" onclick="startConversation('summarize', '请帮我总结一下人工智能的发展历程和主要里程碑')">
                            <i class="fas fa-compress-alt"></i>
                            <span>请帮我总结一下人工智能的发展历程和主要里程碑</span>
                        </div>
                        <div class="suggestion-question" onclick="startConversation('expand', '请帮我扩写关于人工智能在医疗领域应用的内容')">
                            <i class="fas fa-expand-alt"></i>
                            <span>请帮我扩写关于人工智能在医疗领域应用的内容</span>
                        </div>
                        <div class="suggestion-question" onclick="startConversation('continue', '随着科技的不断发展，我们的生活变得越来越便利')">
                            <i class="fas fa-arrow-right"></i>
                            <span>随着科技的不断发展，我们的生活变得越来越便利</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // 显示消息提示
        function showMessage(message, type = 'info') {
            // 创建消息元素
            const messageDiv = document.createElement('div');
            messageDiv.className = `message message-${type}`;
            messageDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            // 添加样式
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 500;
                z-index: 1001;
                display: flex;
                align-items: center;
                gap: 8px;
                animation: slideIn 0.3s ease;
                background: ${type === 'success' ? '#28a745' : type === 'error' ? '#dc3545' : '#17a2b8'};
            `;
            
            // 添加到页面
            document.body.appendChild(messageDiv);
            
            // 3秒后自动移除
            setTimeout(() => {
                messageDiv.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => {
                    if (messageDiv.parentNode) {
                        messageDiv.parentNode.removeChild(messageDiv);
                    }
                }, 300);
            }, 3000);
        }

        // API配置相关函数
        function openConfigModal() {
            // 加载已保存的密钥
            const openaiKey = localStorage.getItem('openai_api_key');
            const huggingfaceKey = localStorage.getItem('huggingface_api_key');
            
            if (openaiKey) {
                openaiApiKeyInput.value = openaiKey;
            }
            if (huggingfaceKey) {
                huggingfaceApiKeyInput.value = huggingfaceKey;
            }
            
            configModal.classList.add('show');
        }

        function closeConfigModal() {
            configModal.classList.remove('show');
            openaiApiKeyInput.value = '';
            huggingfaceApiKeyInput.value = '';
        }

        function updateConfigSection() {
            const selectedType = configApiTypeSelect.value;
            
            // 隐藏所有配置区域
            freeConfig.style.display = 'none';
            openaiConfig.style.display = 'none';
            huggingfaceConfig.style.display = 'none';
            ollamaConfig.style.display = 'none';
            
            // 显示选中的配置区域
            switch(selectedType) {
                case 'free':
                    freeConfig.style.display = 'block';
                    break;
                case 'openai':
                    openaiConfig.style.display = 'block';
                    break;
                case 'huggingface':
                    huggingfaceConfig.style.display = 'block';
                    break;
                case 'ollama':
                    ollamaConfig.style.display = 'block';
                    break;
            }
        }

        function saveApiKey() {
            const selectedType = configApiTypeSelect.value;
            let apiKey = '';
            let isValid = false;
            
            switch(selectedType) {
                case 'free':
                    // 免费API无需配置
                    showMessage('免费API配置完成，无需API密钥', 'success');
                    isValid = true;
                    break;
                    
                case 'openai':
                    apiKey = openaiApiKeyInput.value.trim();
                    if (!apiKey) {
                        showMessage('请输入OpenAI API密钥', 'error');
                        return;
                    }
                    if (!apiKey.startsWith('sk-')) {
                        showMessage('OpenAI API密钥格式不正确，应以sk-开头', 'error');
                        return;
                    }
                    localStorage.setItem('openai_api_key', apiKey);
                    isValid = true;
                    break;
                    
                case 'huggingface':
                    apiKey = huggingfaceApiKeyInput.value.trim();
                    if (!apiKey) {
                        showMessage('请输入Hugging Face API密钥', 'error');
                        return;
                    }
                    if (!apiKey.startsWith('hf_')) {
                        showMessage('Hugging Face API密钥格式不正确，应以hf_开头', 'error');
                        return;
                    }
                    localStorage.setItem('huggingface_api_key', apiKey);
                    isValid = true;
                    break;
                    
                case 'ollama':
                    // Ollama不需要API密钥
                    showMessage('Ollama配置完成，无需API密钥', 'success');
                    isValid = true;
                    break;
            }
            
            if (isValid) {
                closeConfigModal();
                showMessage('API密钥保存成功', 'success');
                checkApiKeyStatus();
            }
        }

        function checkApiKeyStatus() {
            const openaiKey = localStorage.getItem('openai_api_key');
            const huggingfaceKey = localStorage.getItem('huggingface_api_key');
            
            if (currentApiType === 'free' || openaiKey || huggingfaceKey) {
                configBtn.innerHTML = '<i class="fas fa-check"></i> API已配置';
                configBtn.style.background = '#28a745';
            } else {
                configBtn.innerHTML = '<i class="fas fa-cog"></i> 配置API密钥';
                configBtn.style.background = '#667eea';
            }
        }

        // 调试相关函数
        function toggleDebugPanel() {
            debugPanel.classList.toggle('show');
            if (debugPanel.classList.contains('show')) {
                debugToggle.textContent = '关闭调试';
                debugToggle.style.background = '#dc3545';
            } else {
                debugToggle.textContent = '调试模式';
                debugToggle.style.background = '#667eea';
            }
        }

        function addDebugInfo(info) {
            if (debugPanel.classList.contains('show')) {
                const timestamp = new Date().toLocaleTimeString();
                const debugItem = document.createElement('div');
                debugItem.style.marginBottom = '8px';
                debugItem.style.borderBottom = '1px solid #444';
                debugItem.style.paddingBottom = '8px';
                debugItem.innerHTML = `<strong>${timestamp}</strong><br>${info}`;
                debugContent.appendChild(debugItem);
                debugContent.scrollTop = debugContent.scrollHeight;
            }
        }

        // 开始对话函数
        function startConversation(operation, question) {
            // 清空输入框
            inputText.value = '';
            
            // 显示用户问题
            const timestamp = new Date().toLocaleTimeString();
            const operationText = {
                'summarize': '总结',
                'expand': '扩写',
                'continue': '续写'
            };
            
            // 获取当前聊天记录
            let chatHistory = outputText.querySelector('.chat-history');
            if (!chatHistory) {
                chatHistory = document.createElement('div');
                chatHistory.className = 'chat-history';
                outputText.innerHTML = '';
                outputText.appendChild(chatHistory);
            }
            
            // 添加用户消息
            const userMessage = document.createElement('div');
            userMessage.className = 'message user-message';
            userMessage.innerHTML = `
                <div class="message-content">
                    <div class="message-header">
                        <span class="user-name">用户</span>
                        <span class="message-time">${timestamp}</span>
                    </div>
                    <div class="message-text">${question}</div>
                    <div class="message-operation">操作：${operationText[operation]}</div>
                </div>
            `;
            chatHistory.appendChild(userMessage);
            
            // 生成AI回复（兜底策略）
            const aiResponse = generateMockResponse(operation, question);
            
            // 添加AI回复
            const aiMessage = document.createElement('div');
            aiMessage.className = 'message ai-message';
            aiMessage.innerHTML = `
                <div class="message-content">
                    <div class="message-header">
                        <span class="ai-name">超级助理</span>
                        <span class="message-time">${timestamp}</span>
                    </div>
                    <div class="message-text">${aiResponse}</div>
                    <button class="copy-reply-btn" onclick="copyReply(this)" title="复制回复">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
            `;
            chatHistory.appendChild(aiMessage);
            
            // 滚动到底部
            outputText.scrollTop = outputText.scrollHeight;
            
            showMessage('对话已开始', 'success');
        }

        // 兜底回复话术
        function getFallbackResponse(operation, text) {
            const operationText = {
                'summarize': '总结',
                'expand': '扩写',
                'continue': '续写'
            };
            
            const responses = {
                summarize: `抱歉，我暂时无法对您提供的文本进行${operationText[operation]}。

**可能的原因：**
- 文本内容过于复杂或专业
- 当前服务暂时不可用
- 文本格式需要调整

**建议：**
- 请尝试简化文本内容
- 稍后再次尝试
- 或者尝试其他操作功能

您提供的文本内容：${text.substring(0, 100)}${text.length > 100 ? '...' : ''}`,
                
                expand: `很抱歉，我目前无法对您的文本进行${operationText[operation]}。

**可能的原因：**
- 文本内容过于简短或抽象
- 扩写方向不够明确
- 当前服务负载较高

**建议：**
- 请提供更详细的原始内容
- 明确扩写的具体方向
- 稍后再次尝试

您提供的文本内容：${text.substring(0, 100)}${text.length > 100 ? '...' : ''}`,
                
                continue: `抱歉，我暂时无法对您的文本进行${operationText[operation]}。

**可能的原因：**
- 文本内容不完整或上下文不足
- 续写风格难以把握
- 当前服务暂时不可用

**建议：**
- 请提供更完整的上下文
- 明确续写的风格要求
- 稍后再次尝试

您提供的文本内容：${text.substring(0, 100)}${text.length > 100 ? '...' : ''}`
            };
            
            return responses[operation] || `抱歉，我暂时无法处理这个${operationText[operation]}请求。请稍后再试或尝试其他问题。`;
        }

        // 复制单条回复
        function copyReply(button) {
            const messageContent = button.closest('.message-content');
            const messageText = messageContent.querySelector('.message-text');
            const text = messageText.textContent || messageText.innerText;
            
            navigator.clipboard.writeText(text).then(() => {
                showMessage('回复内容已复制', 'success');
            }).catch(() => {
                showMessage('复制失败', 'error');
            });
        }

        // 兜底策略 - 生成模拟回复
        function generateMockResponse(operation, question) {
            const responses = {
                summarize: {
                    '请帮我总结一下人工智能的发展历程和主要里程碑': `人工智能的发展历程可以分为以下几个重要阶段：

1. **早期发展（1950-1960年代）**：图灵测试的提出，标志着AI研究的开始。这一时期主要关注符号推理和逻辑编程。

2. **专家系统时代（1970-1980年代）**：专家系统成为主流，如DENDRAL、MYCIN等系统在特定领域表现出色。

3. **机器学习兴起（1990-2000年代）**：统计学习方法开始流行，支持向量机、决策树等算法得到广泛应用。

4. **深度学习革命（2010年代至今）**：神经网络技术的突破，特别是深度学习在图像识别、自然语言处理等领域取得重大进展。

5. **大语言模型时代（2020年代至今）**：GPT、BERT等大模型的出现，让AI在理解和生成人类语言方面达到新高度。

主要里程碑包括：图灵测试（1950）、专家系统（1970s）、机器学习算法（1990s）、深度学习突破（2012）、大语言模型（2018至今）。`
                },
                expand: {
                    '请帮我扩写关于人工智能在医疗领域应用的内容': `人工智能在医疗领域的应用正在深刻改变着整个行业，其应用范围涵盖了从预防、诊断到治疗的各个环节：

**1. 医学影像诊断**
- **CT/MRI图像分析**：AI能够快速识别肿瘤、骨折、血管病变等异常情况，准确率可达95%以上
- **X光片解读**：自动检测肺炎、肺结核等肺部疾病，大幅提高诊断效率
- **病理切片分析**：辅助病理学家识别癌细胞，减少漏诊和误诊

**2. 药物研发**
- **分子设计**：AI算法可以预测药物分子的活性，加速新药开发过程
- **临床试验优化**：智能筛选合适的受试者，提高试验成功率
- **药物重定位**：发现现有药物的新用途，降低研发成本

**3. 个性化医疗**
- **基因组分析**：结合患者基因信息，制定个性化治疗方案
- **精准用药**：根据患者个体差异，优化药物剂量和给药方案
- **疾病预测**：基于大数据分析，预测疾病发生风险

**4. 智能医疗设备**
- **手术机器人**：提高手术精度，减少创伤，加快恢复
- **智能监护设备**：实时监测患者生命体征，及时预警
- **康复辅助设备**：个性化康复训练，提高康复效果

**5. 医疗管理优化**
- **电子病历管理**：智能整理和分析患者信息，提高诊疗效率
- **医疗资源调度**：优化医院资源配置，减少等待时间
- **远程医疗**：打破地域限制，让优质医疗资源惠及更多患者

这些应用不仅提高了医疗质量和效率，还在降低医疗成本、改善患者体验方面发挥着重要作用。`
                },
                continue: {
                    '随着科技的不断发展，我们的生活变得越来越便利': `随着科技的不断发展，我们的生活变得越来越便利。智能手机、智能家居、自动驾驶汽车等技术的出现，让我们的日常活动变得更加高效和舒适。

**智能家居的普及**让我们的居住环境更加智能化。通过语音助手，我们可以轻松控制家中的灯光、空调、音响等设备，甚至可以通过手机远程监控家中的安全状况。智能家电的加入，如智能冰箱能够自动识别食物并提醒补充，智能洗衣机可以根据衣物类型自动选择最佳洗涤程序，这些都大大减轻了我们的家务负担。

**移动支付的广泛应用**彻底改变了我们的消费方式。从现金支付到刷卡支付，再到现在的扫码支付和刷脸支付，每一次技术升级都让支付变得更加便捷。我们不再需要携带大量现金，一部手机就能完成各种消费场景的支付需求，同时还能享受各种优惠和积分奖励。

**在线教育的兴起**让学习变得更加灵活和个性化。无论是职业技能培训、语言学习，还是兴趣爱好培养，都可以通过网络平台进行。AI技术的应用让教育内容更加智能化，能够根据学习者的进度和特点提供个性化的学习建议和内容推荐。

**远程办公的普及**让工作方式发生了根本性变革。云计算、视频会议、协作工具等技术的发展，让员工可以在任何地方高效地完成工作。这不仅提高了工作效率，还改善了工作与生活的平衡，减少了通勤时间和成本。

**健康科技的进步**让我们的健康管理变得更加科学和便捷。智能手环、健康APP等设备可以实时监测我们的运动量、睡眠质量、心率等健康指标，并提供个性化的健康建议。AI诊断技术的应用，让一些基础的健康问题可以通过在线咨询得到初步判断。

这些科技创新的应用，不仅提高了我们的生活质量，还在推动社会进步和经济发展方面发挥着重要作用。未来，随着5G、物联网、人工智能等技术的进一步发展，我们的生活将会变得更加智能化和便利化。`
                }
            };
            
            return responses[operation][question] || `抱歉，我暂时无法处理这个${operationText[operation]}请求。请稍后再试或尝试其他问题。`;
        }

        function handleSend() {
            const text = inputText.value.trim();
            if (!text) {
                showMessage('请输入内容', 'error');
                return;
            }
            
            // 自动检测操作类型
            let operation = 'continue';
            if (text.includes('总结') || text.includes('summarize')) {
                operation = 'summarize';
            } else if (text.includes('扩写') || text.includes('expand')) {
                operation = 'expand';
            }
            
            handleOperation(operation);
            
            // 清空输入框
            inputText.value = '';
        }

        // 回车键发送
        inputText.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSend();
            }
        });
    </script>
</body>
</html>
